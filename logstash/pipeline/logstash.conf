input {
  # HTTP input for heartbeat logs
  http {
    host => "0.0.0.0"
    port => 8095
    codec => json
    tags => ["heartbeat"]  # Tag for identifying heartbeat logs
  }

  http {
    host => "0.0.0.0"
    port => 8096
    codec => json
    tags => ["loggs"]  # Tag for identifying heartbeat logs
  }

  http {
    host => "0.0.0.0"
    port => 8097
    codec => json
    tags => ["downup"]  # Tag for identifying downup logs
  }
}

filter {
  # Tag and route logs to the appropriate custom index
  if "heartbeat" in [tags] {
    mutate {
      add_field => { "custom_index_name" => "heartbeatjson" }
    }
  } else if "loggs" in [tags] {
    mutate {
      add_field => { "custom_index_name" => "loggs" }
    }
  } else if "downup" in [tags] {
    mutate {
      add_field => { "custom_index_name" => "downup" }
    }
  }

  # Ensure the custom index name is lowercase
  mutate {
    lowercase => [ "custom_index_name" ]
  }
}

output {
  stdout { codec => rubydebug }

  # Route logs to the Elasticsearch index based on custom index name
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    user => "elastic"
    password => "123al*"  # Use an environment variable or secret manager in production
    index => "%{custom_index_name}-%{+YYYY.MM.dd}"  # Dynamic index name based on custom index name
  }
}
